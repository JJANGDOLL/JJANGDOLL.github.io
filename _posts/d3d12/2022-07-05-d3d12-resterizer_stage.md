---
title: "D3D 레스터화 단계"

categories:
  - D3D12


tags:
  - d3d12
  - resterizer

toc: true
toc_label: Resterizer
toc_sticky: true

sidebar_main: true
---

레즈터라이저 스테이지의 주 임무는 투영된 3차원 삼각형으로부터 픽셀 색상들을 계산하는 것이다.

<br/>

# 뷰포트 변환

클리핑을 마친 뒤엔 하드웨어는 perspective divide(원근 나누기)를 수행해 homogeneous space 에서 NDC 로 변환할 수 있다. 또한 NDC 공간의 정점들은, 2차원 이미지를 형성하는 점들의 2차원 x,y 좌표 성분들이 후면 버퍼의 한 직사각형 영역으로 변환된다. 이 뷰포트 변환 후엔,  x, y 성분은 픽셀 단위의 값이 된다. 일반적으로 뷰포트 변환 시 z 성분은 변경하지 않는다. 하지만 D3D12_VIEWPORT 구조체의 MinDepth 와 MaxDepth 를 변경함으로써 깊이에 영향을 미칠 수 있다. MinDepth 와 MaxDepth 의 값들은 반드시 0~1 의 값이여야 한다.

<br/>

# Backface Culling

하나의 삼각형에는 2개의 면이 있다. 두 면을 구분하기 위해 D3D는 아래와 같은 관례를 사용한다. 삼각형 정점이 $v_0, v_1, v_2$ 순서로 감긴다고 가정할 때, 삼각형의 법선 n은 다음 처럼 정의된다.

$
e_0 = v_1 - v_0
$

$
e_1 = v_2 - v_0
$

$
n = \frac{e_0 \times e_1}{e_0 \times e_1}
$

이 emenates vector(법선 벡터)가 가르키는 방향이 삼각형의 앞쪽이고, 반대편이 뒤쪽이다.

![5_10_2_1](/assets/images/d3d12/5_10_2_1.png)

관찰자에게 보이는 앞쪽 면인 삼각형을 가리켜 front-facing(전면, 전향) 삼각형이라고 부른다. 반대로 뒤쪽 면이 보인다면 back-facing(후면, 후향) 삼각형이라고 한다. 또한 전면 삼각형은 시계방향으로, 후면 삼각형은 반 시계방향으로 감긴다. 

3차원 장면에서 대부분의 물체는 닫힌 다면체 도형이다. 물체를 구성하는 삼각형의 뒷면은 관찰자의 눈에선 보이지 않는다. 그러므로 후면 삼각형은 전혀 그릴 필요가 없다. 파이프라인에서 후면 삼각형을 골라서 폐기하는 공정을 후면 선별(backface-culling)이라고 부른다.

![5_10_2_2](/assets/images/d3d12/5_10_2_2.png)

일반적으로 D3D는 시계방향은 전면, 반시계방향은 후면으로 간주한다. 그러나 D3D 렌더 상태 설정에 따라 그 반대 방식도 가능하다.

<br/>

# 정점 속성 보간

삼각형은 정점들로 정의된다. 정점 자료에는 위치 정보 뿐 아니라 색, 법선 벡터, 텍스쳐 좌표 등 추가적인 속성을 붙일 수도 있다. 뷰포트 변환을 거친 후에는 정점의 그러한 특성들을 삼각형을 덮는 각 픽셀에 대해 보간해야 한다. 또한, 정점의 깊이 값도 그런 식으로 보간해서, 각 픽셀에 깊이 버퍼링 알고리즘을 위한 깊이 값을 부여해야 한다.

3차원 공간의 삼각형을 면에 그대로 보간하면 간격이 고르지 않아진다. 그러기에 D3D에는 perspective corect interpolation 이라고 하는 보간 방법을 사용한다.

![5_10_3_1](/assets/images/d3d12/5_10_3_1.png)

<br/>
